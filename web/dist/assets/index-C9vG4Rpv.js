(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class d{constructor(){this.ws=null,this.wsUrl="ws://localhost:8765",this.frameCount=0,this.lastFrameTime=0,this.fps=0,this.canvas=document.getElementById("frameCanvas"),this.ctx=this.canvas.getContext("2d"),this.placeholder=document.getElementById("placeholder"),this.connectBtn=document.getElementById("connectBtn"),this.disconnectBtn=document.getElementById("disconnectBtn"),this.fileInput=document.getElementById("fileInput"),this.statusIndicator=document.getElementById("statusIndicator"),this.statusText=document.getElementById("statusText"),this.serverInput=document.getElementById("serverInput"),this.updateServerBtn=document.getElementById("updateServer"),this.fpsElement=document.getElementById("fps"),this.resolutionElement=document.getElementById("resolution"),this.processingTimeElement=document.getElementById("processingTime"),this.frameCountElement=document.getElementById("frameCount"),this.connectionTypeElement=document.getElementById("connectionType"),this.logContainer=document.getElementById("logContainer"),this.initializeEventListeners(),this.log("Viewer initialized","success")}initializeEventListeners(){this.connectBtn.addEventListener("click",()=>this.connectToAndroid()),this.disconnectBtn.addEventListener("click",()=>this.disconnect()),this.fileInput.addEventListener("change",t=>this.handleFileUpload(t)),this.updateServerBtn.addEventListener("click",()=>this.updateServerAddress())}connectToAndroid(){if(this.ws&&this.ws.readyState===WebSocket.OPEN){this.log("Already connected","error");return}this.log(`Connecting to ${this.wsUrl}...`);try{this.ws=new WebSocket(this.wsUrl),this.ws.onopen=()=>this.onWebSocketOpen(),this.ws.onmessage=t=>this.onWebSocketMessage(t),this.ws.onerror=t=>this.onWebSocketError(t),this.ws.onclose=()=>this.onWebSocketClose()}catch(t){this.log(`Connection failed: ${t}`,"error"),this.updateConnectionStatus(!1)}}onWebSocketOpen(){this.log("Connected to Android app!","success"),this.updateConnectionStatus(!0),this.connectBtn.disabled=!0,this.disconnectBtn.disabled=!1,this.connectionTypeElement.textContent="WebSocket (Live)"}onWebSocketMessage(t){try{const e=JSON.parse(t.data);e.type==="frame"&&e.data&&(this.displayFrame(e.data),this.updateFPS()),e.type==="stats"&&e.stats&&this.updateStats(e.stats)}catch{typeof t.data=="string"&&(this.displayFrame(t.data),this.updateFPS())}}onWebSocketError(t){this.log("WebSocket error occurred","error"),console.error("WebSocket error:",t)}onWebSocketClose(){this.log("Disconnected from Android app"),this.updateConnectionStatus(!1),this.connectBtn.disabled=!1,this.disconnectBtn.disabled=!0,this.ws=null}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.updateConnectionStatus(!1),this.connectBtn.disabled=!1,this.disconnectBtn.disabled=!0,this.log("Manually disconnected")}handleFileUpload(t){var n;const i=(n=t.target.files)==null?void 0:n[0];if(!i)return;this.log(`Loading file: ${i.name}`);const s=new FileReader;s.onload=o=>{var r;const a=(r=o.target)==null?void 0:r.result;this.displayFrame(a),this.connectionTypeElement.textContent="Static Image",this.log("Static image loaded successfully","success")},s.readAsDataURL(i)}displayFrame(t){const e=new Image;e.onload=()=>{this.placeholder.style.display="none",this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(e,0,0),this.frameCount++,this.frameCountElement.textContent=this.frameCount.toString(),this.resolutionElement.textContent=`${e.width} x ${e.height}`},t.startsWith("data:")?e.src=t:e.src=`data:image/jpeg;base64,${t}`}updateFPS(){const t=performance.now();if(this.lastFrameTime>0){const e=t-this.lastFrameTime;this.fps=Math.round(1e3/e),this.fpsElement.textContent=this.fps.toString()}this.lastFrameTime=t}updateStats(t){t.fps!==void 0&&(this.fpsElement.textContent=t.fps.toString()),t.width!==void 0&&t.height!==void 0&&(this.resolutionElement.textContent=`${t.width} x ${t.height}`),t.processingTime!==void 0&&(this.processingTimeElement.textContent=`${t.processingTime.toFixed(2)} ms`),t.frameCount!==void 0&&(this.frameCount=t.frameCount,this.frameCountElement.textContent=t.frameCount.toString())}updateConnectionStatus(t){t?(this.statusIndicator.classList.remove("disconnected"),this.statusIndicator.classList.add("connected"),this.statusText.textContent="Connected"):(this.statusIndicator.classList.remove("connected"),this.statusIndicator.classList.add("disconnected"),this.statusText.textContent="Disconnected",this.connectionTypeElement.textContent="None")}updateServerAddress(){const t=this.serverInput.value.trim();t&&(t.startsWith("ws://")||t.startsWith("wss://"))?(this.wsUrl=t,document.getElementById("serverAddress").textContent=t,this.log(`Server address updated to: ${t}`,"success")):this.log("Invalid WebSocket URL. Must start with ws:// or wss://","error")}log(t,e="info"){const i=new Date().toLocaleTimeString(),s=document.createElement("div");for(s.className=`log-entry ${e}`,s.innerHTML=`
            <span class="log-timestamp">[${i}]</span>
            <span class="log-message">${t}</span>
        `,this.logContainer.appendChild(s),this.logContainer.scrollTop=this.logContainer.scrollHeight;this.logContainer.children.length>50;)this.logContainer.removeChild(this.logContainer.firstChild)}}document.addEventListener("DOMContentLoaded",()=>{new d});
